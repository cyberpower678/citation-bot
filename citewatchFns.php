<?function citation_is_redirect ($type, $id) {   #TODO  #$db = udbconnect("yarrow");  #$sql = "SELECT $type, redirect FROM cite_$type WHERE $type='$id'";  #$result = mysql_query($sql);  #$results = mysql_fetch_array($result, MYSQL_ASSOC);  #mysql_close();  if ($result) {    if ($results) {      return $results["redirect"]?1:0;    } else {      // this page isn't in our mysql database      $page_status = isRedirect("Template:Cite $type/$id");      if ($page_status[0] == 1) {        return 2; // Page exists; we need to check that the redirect has been created.      } else {        return $page_status[0]; // 0 or -1      }    }  } else {    // On error consult wikipedia API    return (isRedirect("Template:Cite $type/$id"));  }}function fill_page ($page, $type, $id, $bonus_ids) {  global $ON, $dotDecode, $dotEncode;  $type = strtolower($type);  $template = 'Cite ' . $type;  switch ($type) {    case "doi":      if (!get_data_from_doi($id, true) && substr($id, 0, 8) == "10.2307/") {        // Invalid DOI generated from 10.2307/JSTORID.  Just use JSTOR parameter        $encoded_id = anchorencode($id);        $type = 'jstor';        $template = 'Cite doi';        $id = substr($id, 8);      } else {        $encoded_id = anchorencode($id);      }    break;    default:      $encoded_id = $id;  }    // Don't go creating a page that already exists.  print "\nTemplate:Cite $type/$encoded_id\n";  print (getArticleId("Template:Cite $type/$encoded_id"));  if (getArticleId("Template:Cite $type/$encoded_id")) return false;  foreach ($bonus_ids as $key => $value) {    $bonus .= " | $key = $value\n";  }  print "{{Cite journal\n | $type = $id\n$bonus}}\n\n";    return expand("Template:$template/$encoded_id", $ON, true,                  "{{Cite journal\n | $type = $id\n$bonus}}<noinclude>{{Documentation|Template:cite_$type/subpage}}</noinclude>", -1);}function doi_citation_exists ($doi) {  $db = udbconnect("yarrow"); #TODO  #$sql = "SELECT doi FROM cite_doi WHERE doi='" . addslashes($doi) . "'";  #$result = mysql_query($sql);  #$results = mysql_fetch_row($result);  #mysql_close();  if ($result) {    if ($results[0]) {      return true;    } else {      $doi_page = "Template:Cite doi/" . anchorencode($doi);      if (articleID($doi_page)) {        log_citation("doi", $doi);        return true;      } else {        return false;      }    }  } else {    // On error consult wikipedia API    $doi_page = "Template:Cite doi/" .anchorencode($doi);    if (articleID($doi_page)) {      log_citation("doi", $doi);      return true;    } else return false;  }}function log_citation ($type, $source, $target = false) {  $db = udbconnect("yarrow"); #TODO  return NULL;   $sql = "INSERT INTO cite_$type SET $type='" . addslashes($source) . "'"       . ($type=="doi"?"":", redirect='" . addslashes($target) . "'");  $result = mysql_query($sql);  return $result?true:false;}